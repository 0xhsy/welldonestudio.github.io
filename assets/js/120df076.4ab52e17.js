"use strict";(self.webpackChunkwelldone_docs=self.webpackChunkwelldone_docs||[]).push([[9718],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=o,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||r;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},14291:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p}});var a=n(83117),o=n(80102),r=(n(67294),n(3905)),i=["components"],s={title:"How to Migrate the Contract",description:"Learning about how to migrate the contract in NEAR"},c="How to Migrate the Contract",l={unversionedId:"tutorials/near-ecosystem/migrate-contract",id:"tutorials/near-ecosystem/migrate-contract",title:"How to Migrate the Contract",description:"Learning about how to migrate the contract in NEAR",source:"@site/docs/tutorials/near-ecosystem/migrate-contract.md",sourceDirName:"tutorials/near-ecosystem",slug:"/tutorials/near-ecosystem/migrate-contract",permalink:"/tutorials/near-ecosystem/migrate-contract",draft:!1,editUrl:"https://github.com/welldonestudio/welldonestudio.github.io/tree/master/docs/tutorials/near-ecosystem/migrate-contract.md",tags:[],version:"current",frontMatter:{title:"How to Migrate the Contract",description:"Learning about how to migrate the contract in NEAR"},sidebar:"tutorialSidebar",previous:{title:"NEAR Account Model",permalink:"/tutorials/near-ecosystem/account"},next:{title:"NEAR Counter Dapp",permalink:"/tutorials/near/"}},d={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Updating Contracts",id:"updating-contracts",level:2},{value:"Re-deploy another contract",id:"re-deploy-another-contract",level:3},{value:"Migrating the State",id:"migrating-the-state",level:3},{value:"Programmatic Update",id:"programmatic-update",level:3},{value:"Get your Hands Dirty on WELLDONE Code",id:"get-your-hands-dirty-on-welldone-code",level:2},{value:"Deploy the Contract",id:"deploy-the-contract",level:3},{value:"Writing a Migration Method",id:"writing-a-migration-method",level:3},{value:"Re-deploy the Contract",id:"re-deploy-the-contract",level:3},{value:"Wrap-Up",id:"wrap-up",level:2},{value:"Reference",id:"reference",level:3}],u={toc:p};function m(e){var t=e.components,s=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-migrate-the-contract"},"How to Migrate the Contract"),(0,r.kt)("div",null,(0,r.kt)("span",{className:"author-sm"},"January 3, 2023"),(0,r.kt)("div",{className:"author-div"},(0,r.kt)("div",{className:"author-avatars"},(0,r.kt)("a",{href:"https://github.com/Yoon-Suji",target:"_blank"},(0,r.kt)("img",{src:"https://avatars.githubusercontent.com/u/70956926?v=4"}))),(0,r.kt)("div",null,(0,r.kt)("span",{className:"author-name"},"Suji Yoon"),(0,r.kt)("br",null),(0,r.kt)("span",{className:"author-sm"},"Software Engineer, DSRV ")))),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"In NEAR, the smart contract is stored in the state of the Account. We learned from the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.welldonestudio.io/tutorials/near-ecosystem/account"},"Account Model tutorial")," that only one account can be deployed and activated per account. If we want to change a contract that has already been deployed, what should we do? This tutorial takes a look at various ways to update smart contracts that have already been deployed and has hands-on contract migration exercises using the WELLDONE Code."),(0,r.kt)("h2",{id:"updating-contracts"},"Updating Contracts"),(0,r.kt)("p",null,"During the development, and sometimes even in production, updates to a contract\u2019s code (or even data) are needed. If you are in the local development environment, you can simply deploy an updated contract to a new account, but the downside is that you cannot use the data from the previously deployed contract as it is. Therefore, if you want to keep the data from previously deployed contracts, or if you have already deployed contracts to the mainnet and are operating the service, you should use the method of migrating contracts deployed to your existing account."),(0,r.kt)("p",null,"Let\u2019s now look at three ways to update your contract."),(0,r.kt)("h3",{id:"re-deploy-another-contract"},"Re-deploy another contract"),(0,r.kt)("p",null,"You can update contracts by simply redeploying them to the new account if you don't need to maintain the previously deployed contracts\u2019 state. You can easily create a new ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-account")," and deploy the contract using NEAR CLI\u2019s ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-deploy")," command in the testnet. If you want to use the same account ID you used before, delete the account and create an account with the same name again. When an account is deleted, data from an existing contract is also deleted, so you can get the same effect as deploying the contract to the new account."),(0,r.kt)("p",null,"To deploy the contract to dev-account, you must install ",(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/tools/near-cli#installation"},"NEAR CLI")," first."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near dev-deploy --wasmFile [route_to_wasm]\n")),(0,r.kt)("p",null,"The above command automatically creates a new testnet Account with the prefix ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-")," and deploys the contract to that account. The generated ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-account")," information is stored in the ",(0,r.kt)("inlineCode",{parentName:"p"},"neardev")," folder of the current location, and the private key is stored in the ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.near-credentials")," folder."),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"neardev")," folder already exists, the ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-deploy")," command will deploy contracts to the current ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-account")," rather than creating a new account. As a result, if you want to create a new ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-account")," and deploy the contract again after modifying it, you must delete the ",(0,r.kt)("inlineCode",{parentName:"p"},"neardev")," folder first."),(0,r.kt)("p",null,"Next, let's see how to deploy contracts by deleting existing account and recreating account with the same name. The NEAR CLI is also used for this method. Let's say you wish to update an existing contract that is now deployed to ",(0,r.kt)("inlineCode",{parentName:"p"},"sub-account")," named ",(0,r.kt)("inlineCode",{parentName:"p"},"app-name.you.testnet"),"."),(0,r.kt)("p",null,"First, delete ",(0,r.kt)("inlineCode",{parentName:"p"},"app-name.you.testnet")," where existing contract was deployed. Please be aware that in order to delete an account, you must have the account's Full Access Key."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near delete app-name.you.testnet you.testnet\n")),(0,r.kt)("p",null,"If you run the above command, ",(0,r.kt)("inlineCode",{parentName:"p"},"app-name.you.testnet")," will be deleted, and the token remaining in the account will be sent to ",(0,r.kt)("inlineCode",{parentName:"p"},"you.testnet")," and the data of the contract deployed to that account is also deleted."),(0,r.kt)("p",null,"Then, create a ",(0,r.kt)("inlineCode",{parentName:"p"},"sub-account")," with the same name again and deploy the modified contract to that account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"near create-account app-name.you.testnet --masterAccount you.testnet\nnear deploy --accountId app-name.you.testnet --wasmFile [route_to_wasm]\n")),(0,r.kt)("p",null,"Since all of the contract data in the account will be deleted if you delete and recreate the account, doing it this way will have the effect of deploying the contract for the first time."),(0,r.kt)("h3",{id:"migrating-the-state"},"Migrating the State"),(0,r.kt)("p",null,"If you want to redeploy the updated smart contract in the same Account while keeping the previous contract\u2019s data, you need a method to migrate the smart contract\u2019s state."),(0,r.kt)("p",null,"Why can't we simply redeploy the updated contract to the account where the previous contract was deployed? The smart contract of NEAR is stored in the Account\u2019s state separately in code (logic) and state (storage). So, If you redeploy the contract to the account, the contract\u2019s code will change but the contract\u2019s state will remain the same."),(0,r.kt)("p",null,"When your contract is executed, the NEAR Runtime reads the serialized state from the disk and attempts to load it using the current contract code. If the contract code has a different state than the already deployed one, the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/develop/contracts/serialization#deserialization-error"},(0,r.kt)("inlineCode",{parentName:"a"},"Cannot deserialize the contract state"))," error occurs. Therefore, if you modify the state of the contract, you need a migration method to read the status of the previous contract state."),(0,r.kt)("p",null,"The migration method implements following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Reads the current state of the contract"),(0,r.kt)("li",{parentName:"ol"},"Applies different functions to transform it into the new state"),(0,r.kt)("li",{parentName:"ol"},"Returns the new state")),(0,r.kt)("p",null,"Let's take a closer look at the example using the migration method in the practice part using the WELLDONE Code."),(0,r.kt)("h3",{id:"programmatic-update"},"Programmatic Update"),(0,r.kt)("p",null,"There is a way to implement a method that allows smart contract updates by itself. It is usually used by deploying smart contract code that implements that method, and then deleting all Full Access Keys in the account where the smart contract was deployed. This clearly shows that no one outside, including the developer, can\u2019t modify the smart contract. When all Full Access Keys in the account are deleted, the account is said to be locked. Only the smart contract itself can update the contract in this case."),(0,r.kt)("p",null,"This method ensures that malicious updates do not occur without users consent, as the contract update process is transparent to all dApp users."),(0,r.kt)("p",null,"A smart contract can also update itself by implementing a method that:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Takes the new wasm contract as input"),(0,r.kt)("li",{parentName:"ol"},"Creates a ",(0,r.kt)("inlineCode",{parentName:"li"},"Promise")," to deploy it on itself")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'pub fn update_contract(&self) -> Promise {\n    // Check the caller is authorized to update the code\n    assert!(env::predecessor_account_id() == self.manager, "Only the manager can update the code");\n\n    // Receive the code directly from the input to avoid the\n    // GAS overhead of deserializing parameters\n    let code = env::input().expect("Error: No input").to_vec();\n\n    // Deploy the contract on self\n    Promise::new(env::current_account_id())\n    .deploy_contract(code)\n    .function_call(\n        "migrate".to_string(),\n        NO_ARGS,\n        0,\n        CALL_GAS\n    )\n    .as_return()\n}\n')),(0,r.kt)("p",null,"See full example on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near-examples/update-migrate-rust/blob/main/contracts/self-updates/base/src/update.rs#L10-L28#"},"Github"),". There is also an ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near/near-sdk-js/blob/d1ca261feac5c38768ab30e0b24cf7263d80aaf2/examples/src/programmatic-update-before.ts"},"JavaScript")," example."),(0,r.kt)("h2",{id:"get-your-hands-dirty-on-welldone-code"},"Get your Hands Dirty on WELLDONE Code"),(0,r.kt)("p",null,"Now, let's practice how to write the migration method to update smart contracts written as Rust in the WELLDONE Code."),(0,r.kt)("admonition",{title:"Prerequisites",type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Please create a NEAR testnet account in WELLDONE Wallet referring to the manual in docs. You need a certain amount of NEAR testnet tokens."),(0,r.kt)("li",{parentName:"ul"},"The purpose of this part is to practice contract migration. Please refer to the Code Docs or dApp development tutorial for basic connection and usage of WELLDONE Code."))),(0,r.kt)("p",null,"First, let's take a quick look at the contract we're going to use. This contract is a contract called ",(0,r.kt)("inlineCode",{parentName:"p"},"GuestBook"),", which stores a vector array of structures called ",(0,r.kt)("inlineCode",{parentName:"p"},"PostedMessage")," and a vector array of ",(0,r.kt)("inlineCode",{parentName:"p"},"Balance")," in a state. The method includes ",(0,r.kt)("inlineCode",{parentName:"p"},"add_message")," to add a message, ",(0,r.kt)("inlineCode",{parentName:"p"},"get_message")," to read stored messages, and ",(0,r.kt)("inlineCode",{parentName:"p"},"get_payments")," to read payments. The complete code for the contract can be found in the following ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/near-examples/update-migrate-rust/blob/main/contracts/basic-updates/base/src/lib.rs#L9-L23#"},"repository"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize, Serialize)]\n#[serde(crate = "near_sdk::serde")]\npub struct PostedMessage {\n    pub premium: bool,\n    pub sender: AccountId,\n    pub text: String,\n}\n\n#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize)]\npub struct GuestBook {\n    messages: Vector<PostedMessage>,\n    payments: Vector<Balance>,\n}\n')),(0,r.kt)("h3",{id:"deploy-the-contract"},"Deploy the Contract"),(0,r.kt)("p",null,"Now, let\u2019s go to WELLDONE Code and deploy the ",(0,r.kt)("inlineCode",{parentName:"p"},"GuestBook")," contract first."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Go to NEAR section and Connect to WELLDONE."),(0,r.kt)("p",{parentName:"li"},"The connected account should be the account we will deploy the contract to. Please create a new account that has never deployed contracts before and connect to it."),(0,r.kt)("img",{src:n(48010).Z,alt:"contract_1",style:{width:"320px"}})),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"In the Project section, select Rust option and write a project\u2019s name in Project section then click the New Project button."),(0,r.kt)("img",{src:n(24743).Z,alt:"contract_2",style:{width:"320px"}}),(0,r.kt)("p",{parentName:"li"},"A project structured with the same name will be created in the ",(0,r.kt)("inlineCode",{parentName:"p"},"near")," folder if you open File Explorer."),(0,r.kt)("img",{src:n(60309).Z,alt:"contract_3",style:{width:"320px"}})),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy and paste the code below."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Cargo.toml")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'[package]\nname = "guestbook"\nversion = "1.0.0"\nauthors = ["Near Inc <hello@near.org>"]\nedition = "2021"\n\n[lib]\ncrate-type = ["cdylib"]\n\n[dependencies]\nnear-sdk = "4.0.0"\nuint = { version = "0.9.3", default-features = false }\n')),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"src/lib.rs")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};\nuse near_sdk::collections::Vector;\nuse near_sdk::json_types::U128;\nuse near_sdk::serde::Serialize;\nuse near_sdk::{env, near_bindgen, AccountId, Balance};\n\nconst POINT_ONE: Balance = 100_000_000_000_000_000_000_000;\n\n#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize, Serialize)]\n#[serde(crate = "near_sdk::serde")]\npub struct PostedMessage {\n    pub premium: bool,\n    pub sender: AccountId,\n    pub text: String,\n}\n\n#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize)]\npub struct GuestBook {\n    messages: Vector<PostedMessage>,\n    payments: Vector<Balance>,\n}\n\nimpl Default for GuestBook {\n    fn default() -> Self {\n        Self {\n            messages: Vector::new(b"m"),\n            payments: Vector::new(b"p"),\n        }\n    }\n}\n\n#[near_bindgen]\nimpl GuestBook {\n    #[payable]\n    pub fn add_message(&mut self, text: String) {\n        let payment = env::attached_deposit();\n        let premium = payment >= POINT_ONE;\n        let sender = env::predecessor_account_id();\n\n        let message = PostedMessage {\n            premium,\n            sender,\n            text,\n        };\n        self.messages.push(&message);\n        self.payments.push(&payment);\n    }\n\n    pub fn get_messages(&self, from_index: Option<U128>, limit: Option<u64>) -> Vec<PostedMessage> {\n        let from = u128::from(from_index.unwrap_or(U128(0)));\n\n        self.messages\n            .iter()\n            .skip(from as usize)\n            .take(limit.unwrap_or(10) as usize)\n            .collect()\n    }\n\n    pub fn get_payments(&self, from_index: Option<U128>, limit: Option<u64>) -> Vec<U128> {\n        let from = u128::from(from_index.unwrap_or(U128(0)));\n\n        self.payments\n            .iter()\n            .skip(from as usize)\n            .take(limit.unwrap_or(10) as usize)\n            .map(|x| U128(x))\n            .collect()\n    }\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Compile the contract."),(0,r.kt)("p",{parentName:"li"},"Select Rust compile option and click the Compile button. The wasm file is returned after the compilation is complete."),(0,r.kt)("img",{src:n(76055).Z,alt:"contract_4",style:{width:"320px"}})),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Deploy the Contract."),(0,r.kt)("p",{parentName:"li"},"When the compilation is complete, the Deploy section automatically appears below. Enter the ID of the account for which you want to deploy contracts, and then click the Deploy button. This requires interaction with the WELLDONE Wallet."),(0,r.kt)("img",{src:n(44660).Z,alt:"contract_5",style:{width:"320px"}})),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Execute the contract."),(0,r.kt)("p",{parentName:"li"},"You can see the deployed contract after the deployment is complete. Run the ",(0,r.kt)("inlineCode",{parentName:"p"},"add_messages")," method to check the contract is deployed well. The value passed in the text field becomes a message, and the amount of tokens passed in the deposit becomes payments. Because ",(0,r.kt)("inlineCode",{parentName:"p"},"add_messages")," is the call method, click the Call button to run the method."),(0,r.kt)("img",{src:n(41030).Z,alt:"contract_6",style:{width:"320px"}}),(0,r.kt)("p",{parentName:"li"},"If the transaction is successful, run the ",(0,r.kt)("inlineCode",{parentName:"p"},"get_messages")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"get_payments")," view methods to confirm that the previously added massages and payments values are returned."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"contract_7",src:n(86205).Z,title:"contract_7",width:"606",height:"152"}),"\n",(0,r.kt)("img",{alt:"contract_8",src:n(94117).Z,title:"contract_8",width:"604",height:"91"})))),(0,r.kt)("h3",{id:"writing-a-migration-method"},"Writing a Migration Method"),(0,r.kt)("p",null,"Let's assume that we want to change the state of the contract we deployed as follows. Previously, ",(0,r.kt)("inlineCode",{parentName:"p"},"payments")," were saved in ",(0,r.kt)("inlineCode",{parentName:"p"},"GuestBook"),", but after the change, ",(0,r.kt)("inlineCode",{parentName:"p"},"payments")," will be managed together in ",(0,r.kt)("inlineCode",{parentName:"p"},"PostedMessage"),". We know that when the status of the smart contract is changed like this, the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/develop/contracts/serialization#deserialization-error"},(0,r.kt)("inlineCode",{parentName:"a"},"Cannot deserialize the contract state"))," error will occur if the contract is redeployed into the same account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize, Serialize)]\n#[serde(crate = "near_sdk::serde")]\npub struct PostedMessage {\n    pub payment: u128,\n    pub premium: bool,\n    pub sender: AccountId,\n    pub text: String,\n}\n\n#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize)]\npub struct GuestBook {\n    messages: Vector<PostedMessage>,\n}\n')),(0,r.kt)("p",null,"To solve this problem, we need to add the migration method to the updated contract."),(0,r.kt)("p",null,"Again, the migration method implements following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Reads the current state of the contract"),(0,r.kt)("li",{parentName:"ol"},"Applies different functions to transform it into the new state"),(0,r.kt)("li",{parentName:"ol"},"Returns the new state")),(0,r.kt)("p",null,"In other words, you need to write a method to iterate through the old ",(0,r.kt)("inlineCode",{parentName:"p"},"GuestBook")," state and convert them to a new ",(0,r.kt)("inlineCode",{parentName:"p"},"PostedMesage")," struct(",(0,r.kt)("inlineCode",{parentName:"p"},"payment"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"premium"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"sender"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"text"),")."),(0,r.kt)("p",null,"Please create a new file called ",(0,r.kt)("inlineCode",{parentName:"p"},"src/migrate.rs")," and paste the codes below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'use crate::*;\n\n#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize, Serialize)]\n#[serde(crate = "near_sdk::serde")]\npub struct OldPostedMessage {\n    pub premium: bool,\n    pub sender: AccountId,\n    pub text: String,\n}\n\n#[derive(BorshDeserialize, BorshSerialize)]\npub struct OldState {\n    messages: Vector<OldPostedMessage>,\n    payments: Vector<Balance>,\n}\n\n#[near_bindgen]\nimpl GuestBook {\n    #[private]\n    #[init(ignore_state)]\n    pub fn migrate() -> Self {\n        // retrieve the current state from the contract\n        let old_state: OldState = env::state_read().expect("failed");\n\n        // iterate through the state migrating it to the new version\n        let mut new_messages: Vector<PostedMessage> = Vector::new(b"p");\n\n        for (idx, posted) in old_state.messages.iter().enumerate() {\n            let payment = old_state.payments.get(idx as u64).unwrap_or(0);\n\n            new_messages.push(&PostedMessage {\n                payment,\n                premium: posted.premium,\n                sender: posted.sender,\n                text: posted.text,\n            })\n        }\n\n        // return the new state\n        Self {\n            messages: new_messages,\n        }\n    }\n}\n')),(0,r.kt)("p",null,"Also modify the ",(0,r.kt)("inlineCode",{parentName:"p"},"src/lib.rs")," to the updated version of contact as below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rust"},'use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};\nuse near_sdk::collections::Vector;\nuse near_sdk::json_types::U128;\nuse near_sdk::serde::Serialize;\nuse near_sdk::{env, near_bindgen, AccountId, Balance};\n\nmod migrate;\n\nconst POINT_ONE: Balance = 100_000_000_000_000_000_000_000;\n\n#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize, Serialize)]\n#[serde(crate = "near_sdk::serde")]\npub struct PostedMessage {\n    pub payment: u128,\n    pub premium: bool,\n    pub sender: AccountId,\n    pub text: String,\n}\n\n#[near_bindgen]\n#[derive(BorshDeserialize, BorshSerialize)]\npub struct GuestBook {\n    messages: Vector<PostedMessage>,\n}\n\nimpl Default for GuestBook {\n    fn default() -> Self {\n        Self {\n            messages: Vector::new(b"m"),\n        }\n    }\n}\n\n#[near_bindgen]\nimpl GuestBook {\n    #[payable]\n    pub fn add_message(&mut self, text: String) {\n        let payment = env::attached_deposit();\n        let sender = env::predecessor_account_id();\n        let premium = payment >= POINT_ONE;\n        let message = PostedMessage {\n            payment,\n            sender,\n            premium,\n            text,\n        };\n        self.messages.push(&message);\n    }\n\n    pub fn get_messages(&self, from_index: Option<U128>, limit: Option<u64>) -> Vec<PostedMessage> {\n        let from = u128::from(from_index.unwrap_or(U128(0)));\n\n        self.messages\n            .iter()\n            .skip(from as usize)\n            .take(limit.unwrap_or(10) as usize)\n            .collect()\n    }\n}\n')),(0,r.kt)("p",null,"Here we should note that the ",(0,r.kt)("inlineCode",{parentName:"p"},"migration")," method is the initialization method. This is the method that must be executed first before other methods in the contract are executed, and only once. If you run another method before executing the 'migration' method, the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/develop/contracts/serialization#deserialization-error"},(0,r.kt)("inlineCode",{parentName:"a"},"Cannot deserialize the contract state"))," error will occur the same way."),(0,r.kt)("h3",{id:"re-deploy-the-contract"},"Re-deploy the Contract"),(0,r.kt)("p",null,"Now, let\u2019s redeploy the updated contract to the same account."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Compile the modified contract again."),(0,r.kt)("p",{parentName:"li"},"Delete the ",(0,r.kt)("inlineCode",{parentName:"p"},"out")," folder of the project and click the Compile button. If you do not delete the out folder, the error log ",(0,r.kt)("inlineCode",{parentName:"p"},"If you want to run a new compilation, delete the 'out' directory and click the Compile button again.")," will be printed on the terminal."))),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Specify the ",(0,r.kt)("inlineCode",{parentName:"p"},"migration")," method as an Init function and proceed with redeployment."),(0,r.kt)("p",{parentName:"li"},"A modal window will appear asking the user for their agreement once more because the account already has a contract deployed. Press the YES button to proceed with the deployment."),(0,r.kt)("img",{src:n(30516).Z,alt:"contract_9",style:{width:"320px",paddingRight:"10px"}}),(0,r.kt)("img",{src:n(92081).Z,alt:"contract_10",style:{width:"320px"}})),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Execute the contract."),(0,r.kt)("p",{parentName:"li"},"When the contract deployment is complete, it automatically show the updated contract. By running the ",(0,r.kt)("inlineCode",{parentName:"p"},"get_messages")," method, you can see that the previously stored information is well converted into a newly updated structure and outputs it."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"contract_11",src:n(61563).Z,title:"contract_11",width:"603",height:"164"})))),(0,r.kt)("h2",{id:"wrap-up"},"Wrap-Up"),(0,r.kt)("p",null,"In this tutorial, we learned how to update the contract that has already deployed to account and had hands-on contract migration exercises using the WELLDONE Code."),(0,r.kt)("p",null,"Here\u2019s how to update a contract that already have been deployed to account:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Deploy to a new account"),(0,r.kt)("li",{parentName:"ol"},"Using a migration method"),(0,r.kt)("li",{parentName:"ol"},"Using a programmatic update")),(0,r.kt)("p",null,"We hope this tutorial will help those who are curious about how to maintain the smart contract in NEAR. Thank you for reading!"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"reference"},"Reference"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/develop/upgrade"},"https://docs.near.org/develop/upgrade")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/concepts/web3/near#contract-upgrades"},"https://docs.near.org/concepts/web3/near#contract-upgrades")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.near.org/develop/contracts/serialization#deserialization-error"},"https://docs.near.org/develop/contracts/serialization#deserialization-error")))}m.isMDXComponent=!0},48010:function(e,t,n){t.Z=n.p+"assets/images/contract_1-eed98821916fc93223d7d99f481aa7b1.png"},92081:function(e,t,n){t.Z=n.p+"assets/images/contract_10-e318f7fbc031373e1ef95e80a6d85ad0.png"},24743:function(e,t,n){t.Z=n.p+"assets/images/contract_2-279a9d28c133685c125f04b37922107a.png"},60309:function(e,t,n){t.Z=n.p+"assets/images/contract_3-aa3106ae8375ce452d874632d9c44433.png"},76055:function(e,t,n){t.Z=n.p+"assets/images/contract_4-cee5018076df3507d1d975fd11fb7413.png"},44660:function(e,t,n){t.Z=n.p+"assets/images/contract_5-46d1ef51af3c0ab381685b57c615e013.png"},41030:function(e,t,n){t.Z=n.p+"assets/images/contract_6-0a311b5238b308282fa2642b3229b6ca.png"},30516:function(e,t,n){t.Z=n.p+"assets/images/contract_9-f91bbcf4ddb92da80ec0011763433ef9.png"},61563:function(e,t,n){t.Z=n.p+"assets/images/contract_11-b0e81004393d5c6fa1b718af03464a73.png"},86205:function(e,t,n){t.Z=n.p+"assets/images/contract_7-fbf0c176dacaf31c91457ebedc437544.png"},94117:function(e,t){t.Z="data:image/png;base64,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"}}]);